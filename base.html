<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ReWear - Sustainable Fashion Exchange{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCvsCea87oVpKZYNlKLqk_LKBJ9kd52OX0",
            authDomain: "rewear-platform.firebaseapp.com",
            projectId: "rewear-platform",
            storageBucket: "rewear-platform.firebasestorage.app",
            messagingSenderId: "214329128419",
            appId: "1:214329128419:web:df2f77214f9b8c98ee5cd6"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Make auth available globally
        window.firebaseAuth = auth;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
    </script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gray-50">
    {% block content %}
    {% endblock %}
    
    <script>
        // Global authentication state management
        let currentUser = null;
        
        window.onAuthStateChanged(window.firebaseAuth, (user) => {
            currentUser = user;
            if (user) {
                console.log('User signed in:', user.email);
                // Store token for API calls
                user.getIdToken().then(token => {
                    localStorage.setItem('firebaseToken', token);
                });
            } else {
                console.log('User signed out');
                localStorage.removeItem('firebaseToken');
            }
        });
        
        // Utility function to make authenticated API calls
        async function makeAuthenticatedRequest(url, options = {}) {
            const token = localStorage.getItem('firebaseToken');
            if (token) {
                options.headers = {
                    ...options.headers,
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                };
            }
            return fetch(url, options);
        }
    </script>
</body>
</html>
